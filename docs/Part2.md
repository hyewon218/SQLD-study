# 2. SQL 기본 및 활용

## SQL 기본

## SQL 활용

### 행 순서 관련 함수
- 행 순서 관련 함수는 상위 행의 값을 하위에 출력하거나 하위 행의 값을 상위 행에 출력할 수 있다.
- 특정 위치의 행을 출력할 수 있다. 
  #### 행 순서 관련 윈도우 함수
  - `FIRST_VALUES` : 파티션에서 가장 처음에 나오는 값을 구한다. <br>MIN 함수를 사용해서 같은 결과를 구할 수 있다.
  - `LAST_VALUES` : 파티션에서 가장 나중에 나오는 값을 구한다. <br> MAX 함수를 사용해서 같은 결과를 구할 수 있다.
  - `LAG` : **이전 행**을 가지고 온다.
  - `LEAD` : 윈도우에서 특정 위치의 행을 가지고 온다. <br> 기본값은 **1**이다.


### 계층형 조회(CONNECT BY)
- 계층형 조회는 Oracle 데이터베이스에서 지원하는 것으로 계층형으로 데이터를 조회할 수 있다.
- 예를 들어 부장에서 차장, 차장에서 과장, 과장에서 대리, 대리에서 사원 순으로 트리 형태의 구조를 위에서 아래로 탐색하면서 조회하는 것이다. 물론 역방향 조회도 가능하다.
- CONNECT BY 는 트리 형태의 구조로 질의를 수행하는 것으로 `START WITH` 구는 시작 조건을 의미하고 `CONNECT BY PRIOR` 는 조인 조건이다. Root 노드로부터 하위 노드의 질의를 실행한다.
- 계층형 조회에서 `MAX(LEVEL)` 을 사용하여 **최대 계층 수**를 구할 수 있다. 즉, 계층형 구조에서 마지막 Leaf Node 의 계층값을 구한다.
- 계층형 조회 결과를 명확히 보기 위해서 `LPAD` 함수를 사용할 수 있다.
  #### CONNECT BY 키워드
  - `LEVEL` : 검색 항목의 깊이를 의미한다, 즉, 계층구조에서 가장 상위 레벨(루트 노드)이 **1**이 된다.


- Connect by 구는 순방향 조회와 역방향 조회가 있다. **순방향 조회는 부모 엔터티로부터 자식 엔터티를 찾아가는 검색**을 의미하고, 역방향 조회는 자식 엔터티로부터 부모 엔터티를 찾아가는 검색이다.
  #### 📌 계층형 조회
  - `PRIOR 자식 = 부모` : 부모에서 자식 방향으로 검색을 수행하는 **순방향** 전개
  - `PRIOR 부모 = 자식` : 자식에서 부모 방향으로 검색을 수행하는 역방향 전개
  - `NOCYCLE` : 사이클이 발생하지 않게 한다.
  - `Order siblings by 컬럼명` : 동일한 LEVEL 인 **형제노드 사이에서 정렬을 수행**한다.

<br>

### PIVOT 과 UNPIVOT
PIVOT 이란 테이블에서 하나의 칼럼에 있는 행 값들을 펼쳐 각각을 하나의 컬럼으로만 만들어주는 것을 의미한다.
즉, 데이터를 **행기반에서 열기반**으로 바꾸는 것이 `PIVOT` 이고 다시 **열기반에서 행기반**으로 바꾸는 것이 `UNPIVOT` 이다.

